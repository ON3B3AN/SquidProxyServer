<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title> Squid Proxy: Overview </title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <a class="navbar-brand" href="index.html">CSI-3660 Squid Proxy</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="overview.html">Project Overview</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="members.html">Group Members</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="demo.html">Project Demonstration</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="start.html">Getting Started</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container text-center">
        <h1>Project Overview</h1>
    </div>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-6">
                <div class="card">
                    <h5 class="card-header text-center">Service Overview</h5>
                    <div class="card-body">
                        <h5 class="card-title">Squid Proxy</h5>
                        <p class="card-text">Our service is an implementation of the popular Squid Proxy Service using their SSL Bump method to 'bump' all HTTP and HTTPS network traffic and record it for analysis, in addition to blocking any website by adding the URL to a custom blacklist. We have a custom error page which the client is redirected to if they attempt to visit any blacklisted website. This is done by installing a root certificate authority file generated by the Proxy server on each client machine, as well as marking it as 'trusted'. The CA is generated using Open-SSL.</p>
                        <a href="http://www.squid-cache.org/" class="btn btn-primary">Go to the Squid website</a>
                        <hr>
                        <h5 class="card-title">Squid Analyzer</h5>
                        <p class="card-text">Our service also utilizes a program called Squid Analyzer, which compiles all website and traffic data captured by Squid into tables and graphs for later analysis by system administrators.</p>
                        <a href="http://squidanalyzer.darold.net/" class="btn btn-primary">Go to the Squid Analyzer website</a>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="card">
                    <h5 class="card-header text-center">Service Information</h5>
                    <div class="card-body">
                        <h5 class="card-title">Server Information</h5>
                        <p class="card-text"></p>
                        <ul>
                            <li>Squid Server IP Address: 35.231.48.148</li>
                            <li>Squid Operating Port (for client config): 3129</li>
                            <li>Server Information Site IP: 35.225.159.129</li>
                        </ul>
                        <hr>
                        <h5 class="card-title">Service Compatibility</h5>
                        <p class="card-text"></p>
                        <ul>
                            <li>Operating System: Windows 10, and macOS.</li>
                            <li>Supported Browser: Firefox and Chrome (Chromenot supported due on Mac to security features that cannot be disabled)</li>
                        </ul>
                        <a href="https://www.mozilla.org/en-US/firefox/new/" class="btn btn-primary">Download the latest version of Firefox</a>
                        <hr>
                        <h5 class="card-title">Dependencies</h5>
                        <p class="card-text">The following services are required for all portions of this service to be implemented:</p>
                        <ul>
                            <li>Apache Web Server (for downloading certificate authority and displaying Squid Analyzer data)</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <br>
    <hr><br>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <h5 class="card-header text-center">Service Implementation Guide</h5>
                    <div class="card-body">
                        <div class="card">
                            <div class="card-header">
                                Step 1: Get Your System Ready
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">A. Disable SELinux:
                                    <ul>
                                        <li><b>sudo nano /etc/selinux/config</b></li>
                                        <li>Set <b>SELINUX</b> to <i>disabled</i></li>
                                        <li>Then, reboot your machine.</li>
                                    </ul>
                                </li>
                                <li class="list-group-item">B. Set Google Cloud firewall rules accordingly: <b>tcp:80; tcp:81; tcp:3120; tcp:3128; tcp:3129</b> for both <i>default-allow-http</i> and <i>default-allow-https</i> firewall rules.</li>
                                <li class="list-group-item">C. Set CentOS firewall rules by typing the following commands:
                                    <ul>
                                        <li><b>firewall-cmd --zone=trusted --add-port=3128/tcp --permanent</b></li>
                                        <li><b>firewall-cmd --zone=trusted --add-port=3129/tcp --permanent</b></li>
                                        <li><b>firewall-cmd --zone=trusted --add-port=3120/tcp --permanent</b></li>
                                        <li><b>firewall-cmd --zone=trusted --add-port=81/tcp --permanent</b></li>
                                        <li><b>firewall-cmd --add-service http --permanent</b></li>
                                        <li><b>firewall-cmd --add-service https --permanent</b></li>
                                        <li><b>firewall-cmd --permanent --zone=trusted --add-masquerade</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">D. Download the <a href="common/direct.xml">direct.xml</a> and place it in <b>/etc/firewalld</b></li>
                                <li class="list-group-item">E. Reload firewalld <b>firewall-cmd --reload</b></li>
                            </ul>
                        </div><br>
                        <div class="card">
                            <div class="card-header">
                                Step 2: Install Squid Proxy
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">A. Install Squid and Apache (httpd) by typing <b>sudo yum install squid httpd</b></li>
                                <li class="list-group-item">B. Navigate to the Squid configuration file: <b>cd /etc/squid</b></li>
                                <li class="list-group-item">C. Copy Squid configuration file: <b>cp /etc/squid/squid.conf /etc/squid/squid.conf.orig</b></li>
                                <li class="list-group-item">D. Download our <a href="common/squid.conf">squid.conf</a> and place it in the above directory.</li>
                            </ul>
                        </div><br>
                        <div class="card">
                            <div class="card-header">
                                Step 3: Create and Initialize Server and Client Certificates
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">A. Create server-side certificate:
                                    <ul>
                                        <li><b>cd /etc/squid</b></li>
                                        <li><b>mkdir ssl_cert</b></li>
                                        <li><b>chown squid:squid ssl_cert</b></li>
                                        <li><b>chmod 700 ssl_cert</b></li>
                                        <li><b>sd ssl_cert</b></li>
                                        <li><b>openssl req -new -newkey rsa:2048 -sha256 -days 365 -nodes -x509 -keyout myCA.pem -out myCA.pem</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">B. Create client-side certificate:
                                    <ul>
                                        <li><b>cd /etc/squid</b></li>
                                        <li><b>openssl x509 -in ssl_cert/myCA.pem -outform DER -out myCA.der</b></li>
                                        <li><b>openssl dhparam -outform PEM -out dhparam.pem 2048</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">C. Initialize the SSL certificate directory:
                                    <ul>
                                        <li><b>/usr/lib64/squid/ssl_crtd -c -s /var/lib/ssl_db</b></li>
                                        <li><b>chown -R squid:squid /var/lib/ssl_db/</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">D. Configure Squid service and start it:
                                    <ul>
                                        <li><b>systemctl enable squid</b></li>
                                        <li><b>systemctl restart squid</b></li>
                                        <li><b>systemctl status squid</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">E. Enable IP forwarding
                                    <ul>
                                        <li>Create the following file: <b>/etc/sysctl.d/ip_forward.conf</b></li>
                                        <li>Add the following line: <i>net.ipv4.ip_forward=1</i></li>
                                        <li>Run the following command: <b>sysctl -p /etc/sysctl.d/ip_forward.conf</b></li>
                                    </ul>
                                </li>
                            </ul>
                        </div><br>
                        <div class="card">
                            <div class="card-header">
                                Step 4: Configuring Apache
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">A. Copy the client-side certificate into our Apache Document Root: <b>cp /etc/squid/myCA.der /var/www/html/</b></li>
                                <li class="list-group-item">B. Navigate to the Apache config folder and copy the current httpd.conf file:
                                    <ul>
                                        <li><b>cd /var/www/httpd/conf/httpd.conf</b></li>
                                        <li><b>cp httpd.conf httpd-default.conf</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">C. Download our <a href="common/httpd.conf">httpd.conf</a> and place it in <b>/etc/httpd/conf/httpd.conf</b></li>
                                <li class="list-group-item">D. Download our <a href="common/common.tar">common.tar</a> archive, unpack, and place it in the <b>/var/www/html</b> directory.</li>
                                <li class="list-group-item">E. Restart Apache service
                                    <ul>
                                        <li><b>systemctl enable httpd</b></li>
                                        <li><b>systemctl restart httpd</b></li>
                                    </ul>
                                </li>
                            </ul>
                        </div><br>
                        <div class="card">
                            <div class="card-header">
                                Step 5: Implementing Website Content Filtering (Blacklisting)
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">A. Blocking Websites:
                                    <ul>
                                        <li><b>nano /etc/squid/squid.conf</b></li>
                                        <li>Add any any domain in the form of <i>.domain.com</i> to the <b>acl ban_domains dstdom_regex</b> line in the configuration file.</li>
                                    </ul>
                                </li>
                                <li class="list-group-item">B. Custom Error Page:
                                    <ul>
                                        <li>Download our custom error page: <a href="common/ERR_CUSTOMPAGE.html">ERR_CUSTOMPAGE.html</a> and place it in <b>/usr/share/squid/errors</b></li>
                                        <li><b>chown squid:squid ERR_CUSTOMPAGE.html</b></li>
                                    </ul>
                                </li>
                            </ul>
                        </div><br>
                        <div class="card">
                            <div class="card-header">
                                Step 6: Implementing Squid Analyzer
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">A. Create directory and install Squid Analyzer:
                                    <ul>
                                        <li><b>mkdir /opt/squidanalyzer</b></li>
                                        <li><b>cd /opt/squidanalyzer</b></li>
                                        <li><b>yum install gd make libpng perl-ExUtils-MakeMaker perl-GD-Graph perl-GD-Graph3d perl-TimesHiRes</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">B. Install Development Tools and perl-devel packages:
                                    <ul>
                                        <li><b>yum group install “Development Tools”</b></li>
                                        <li><b>yum install perl-devel</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">C. Download SquidAnalyzer file and install:
                                    <ul>
                                        <li><b>wget https://tenet.dl.sourceforge.net/project/squid-report/squid-report/6.6/squidanalyzer-6.6.tar.gz</b></li>
                                        <li><b>tar -zxvf squidanalyzer-6.6.tar.gz</b></li>
                                        <li><b>cd squidanalyzer-6.6</b></li>
                                        <li><b>perl Makefile.PL</b></li>
                                        <li><b>make</b></li>
                                        <li><b>make install</b></li>
                                    </ul>
                                </li>
                                <li class="list-group-item">D. Import SquidAnalyzer Config File:
                                    <ul>
                                        <li>Make a copy of the current squidanalyzer.conf file: <b>cp /etc/squidanalyzer/squidanalyzer.conf /etc/squidanalyzer/squidanalyzer.conf.bak</b></li>
                                        <li>Download our Squid Analyzer configuration file: <a href="common/squidanalyzer.conf">squidanalyzer.conf</a> and place it in <b>/etc/squidanalyzer/</b></li>
                                        <li>Copy the SquidAnalyzer folder into your ../HTML/ Directory: <b>cp /var/www/SquidAnalyzer /var/www/html/SquidAnalyzer</b></li>
					<li>To run a data capture with Squid Analyzer, run the following command: <b>/usr/local/bin/squid-analyzer</b></li>
                                        
                                    </ul>
                                </li>

                            </ul>
                        </div><br>
                        <div class="card">
                            <div class="card-header">
                                Step 7: Configuring Client Browsers
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">A. Go to the URL address of your server which contains the <i>myCA.der</i> file and save it to the client computer. For example, our server URL is: <b>http://35.231.48.148:81/myCA.der</b></li>
                                <li class="list-group-item">B. Open the Firefox browser and follow import the certificate. Please go to our <a href="demo.html">Project Demonstration</a> page for how to import certificates into the web browser.</li>
                            </ul>
                        </div><br>
                        <div class="card">
                            <div class="card-header">
                                Guide References:
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item"><a href="https://www.agix.com.au/minimal-transparent-squid-proxy-with-ssl-interception-bumping-on-centos-7/">AGIX: Minimal Transparent Squid Proxy with SSL Interception/Bumping on CentOS 7</a></li>
                                <li class="list-group-item"><a href="https://www.cyberciti.biz/faq/disable-selinux-on-centos-7-rhel-7-fedora-linux/">nixCraft: Disable SELinux on CentOS7</a></li>
                                <li class="list-group-item"><a href="https://chimera40.wordpress.com/2018/07/18/install-and-configure-squid-with-ssl-bump-on-centos7-restrict-domain-and-url-access-with-squidguard-and-analyze-it-all-with-squidanalyzer/">Chimera's Blog: Install and Configure Squid with SSL-Bump on CentOS7 ,Restrict Domain and URL access with SquidGuard and Analyze it all with SquidAnalyzer</a></li>
                                <li class="list-group-item"><a href="https://wiki.squid-cache.org/Features/SslPeekAndSplice">Squid: SslBump Peek and Splice</a></li>
                                <li class="list-group-item"><a href="https://wiki.squid-cache.org/ConfigExamples">Squid: Proxy Configuration Examples</a></li>
                            </ul>
                        </div><br>
                    </div>
                </div><br>
            </div>
        </div>
    </div>

    <footer class="page-footer font-medium blue fixed-bottom">
        <div class="footer-copyright text-center pg-3 bg-primary text-white">
            © Copyright 2019 Sal Trupiano, Travis Thayer, All Rights Reserved
        </div>
    </footer>


</body>

</html>
